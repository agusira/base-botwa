import{format}from"util";import func from"../lib/function.js";import{database as db}from"../database/database.js";import sockets from"../lib/sockets.js";import schema from"../lib/schema.js";export default class Handler{constructor(i,t,e){this.m=i,this.sock=t,this.store=e}async run(){if(await sockets.call(this.sock),await schema.call(db.data,this.m),!this.m.isBaileys&&(!db.data.config?.self||this.m?.isOwner)){var i,t=await func.loadPlugin("./src/plugins/"),e={sock:this.sock,store:this.store,func:func,db:db.data};for(i of t){if(i?.branch&&"function"==typeof i?.branch)try{i?.branch(this.m,e)}catch(i){console.error(i)}if(i?.command?.includes(this.m?.command)){if(i?.owner&&!this.m.isOwner)return void this.m.reply("Perintah khusus Owner");if(i?.premium&&!this.m.isPrems)return void this.m.reply("Perintah khusus user premium");if(i?.group&&!this.m.isGroup)return this.m.reply("Gunakan perintah di dalam Group");if(i?.private&&this.m.isGroup)return this.m.reply("Gunakan perintah di private chat");if(i?.example&&!this.m.query)return this.m.reply(i?.example.replace("%prefix",this.m.prefix).replace("%command",this.m.command));try{await i(this.m,e)}catch(i){this.m.reply(format(i))}finally{console.log("Saving database..."),db.save();break}}if(i?.setPrefix&&this.m?.body?.startsWith(i?.setPrefix)){this.m.query=this.m?.body?.slice(i?.setPrefix.length);try{await i(this.m,e);break}catch(i){this.m.replyy(format(i))}}}}}}import{fileURLToPath,pathToFileURL}from"url";import{watchFile,unwatchFile}from"fs";global.__filename=function(i=import.meta.url,t="win32"!==platform){return t?/file:\/\/\//.test(i)?fileURLToPath(i):i:pathToFileURL(i).toString()},global.__dirname=function(i){return path.dirname(global.__filename(i,!0))};let file=import.meta.filename;watchFile(file,async()=>{unwatchFile(file),console.log("reload file "+file.split("/").slice(file.split("/").length-2).join("/")),import("./handler.js?update="+Date.now())});
